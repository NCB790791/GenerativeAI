"use strict";var i=Object.defineProperty;var l=Object.getOwnPropertyDescriptor;var u=Object.getOwnPropertyNames;var m=Object.prototype.hasOwnProperty;var S=(e,s)=>{for(var r in s)i(e,r,{get:s[r],enumerable:!0})},R=(e,s,r,a)=>{if(s&&typeof s=="object"||typeof s=="function")for(let t of u(s))!m.call(e,t)&&t!==r&&i(e,t,{get:()=>s[t],enumerable:!(a=l(s,t))||a.enumerable});return e};var g=e=>R(i({},"__esModule",{value:!0}),e);var h={};S(h,{handler:()=>f});module.exports=g(h);var o=require("@aws-sdk/client-iam"),p=require("timers/promises"),y=new o.IAMClient({}),f=async(e,s)=>{try{switch(e.RequestType){case"Create":case"Update":console.log(`trying to create a service linked role for ${e.ResourceProperties.awsServiceName}`);try{let r=new o.CreateServiceLinkedRoleCommand({AWSServiceName:e.ResourceProperties.awsServiceName,Description:e.ResourceProperties.description,CustomSuffix:e.ResourceProperties.customSuffix});await y.send(r),console.log("the service linked role created successfully, now waiting for IAM propagation"),await(0,p.setTimeout)(e.ResourceProperties.waitTimeSeconds*1e3)}catch(r){if(r instanceof o.InvalidInputException){console.log(`The service linked role seems to already exist, skipping the creation... ${r.message}`);break}else throw r}break;case"Delete":break}await n("SUCCESS",e,s)}catch(r){await n("FAILED",e,s,r.message)}},n=async(e,s,r,a)=>{let t=s.ResourceProperties,d=`${t.awsServiceName}-${t.customSuffix??""}`,c=JSON.stringify({Status:e,Reason:(a??"")+" See the details in CloudWatch Log Stream: "+r.logStreamName,PhysicalResourceId:d,StackId:s.StackId,RequestId:s.RequestId,LogicalResourceId:s.LogicalResourceId,NoEcho:!1,Data:{}});await(await fetch(s.ResponseURL,{method:"PUT",body:c,headers:{"Content-Type":"","Content-Length":c.length.toString()}})).text()};0&&(module.exports={handler});

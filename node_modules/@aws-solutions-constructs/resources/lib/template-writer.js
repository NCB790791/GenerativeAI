"use strict";
/**
 *  Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.
 *
 *  Licensed under the Apache License, Version 2.0 (the "License"). You may not use this file except in compliance
 *  with the License. A copy of the License is located at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 *  or in the 'license' file accompanying this file. This file is distributed on an 'AS IS' BASIS, WITHOUT WARRANTIES
 *  OR CONDITIONS OF ANY KIND, express or implied. See the License for the specific language governing permissions
 *  and limitations under the License.
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.createTemplateWriterCustomResource = createTemplateWriterCustomResource;
const iam = require("aws-cdk-lib/aws-iam");
const lambda = require("aws-cdk-lib/aws-lambda");
const aws_cdk_lib_1 = require("aws-cdk-lib");
const aws_s3_assets_1 = require("aws-cdk-lib/aws-s3-assets");
const path = require("path");
const custom_resources_1 = require("aws-cdk-lib/custom-resources");
const core_1 = require("@aws-solutions-constructs/core");
const utils_1 = require("./utils");
const defaults = require("@aws-solutions-constructs/core");
function createTemplateWriterCustomResource(scope, id, props) {
    const outputAsset = new aws_s3_assets_1.Asset(scope, `${id}OutputAsset`, {
        path: path.join(__dirname, 'placeholder')
    });
    const templateWriterLambda = (0, core_1.buildLambdaFunction)(scope, {
        lambdaFunctionProps: {
            runtime: defaults.COMMERCIAL_REGION_LAMBDA_NODE_RUNTIME,
            handler: 'index.handler',
            code: lambda.Code.fromAsset(`${__dirname}/template-writer-custom-resource`),
            timeout: props.timeout,
            memorySize: props.memorySize,
        }
    });
    const templateWriterPolicy = new iam.Policy(scope, `${id}TemplateWriterPolicy`, {
        statements: [
            new iam.PolicyStatement({
                actions: ['s3:GetObject'],
                effect: iam.Effect.ALLOW,
                resources: [`arn:${aws_cdk_lib_1.Aws.PARTITION}:s3:::${props.templateBucket.bucketName}/${props.templateKey}`]
            }),
            new iam.PolicyStatement({
                actions: ['s3:PutObject'],
                effect: iam.Effect.ALLOW,
                resources: [`arn:${aws_cdk_lib_1.Aws.PARTITION}:s3:::${outputAsset.s3BucketName}/*`]
            })
        ]
    });
    templateWriterLambda.role?.attachInlinePolicy(templateWriterPolicy);
    const templateWriterProvider = new custom_resources_1.Provider(scope, `${id}TemplateWriterProvider`, {
        onEventHandler: templateWriterLambda
    });
    (0, utils_1.addCfnSuppressRulesForCustomResourceProvider)(templateWriterProvider);
    const customResource = new aws_cdk_lib_1.CustomResource(scope, `${id}TemplateWriterCustomResource`, {
        resourceType: 'Custom::TemplateWriter',
        serviceToken: templateWriterProvider.serviceToken,
        properties: {
            TemplateValues: JSON.stringify({ templateValues: props.templateValues }),
            TemplateInputBucket: props.templateBucket.bucketName,
            TemplateInputKey: props.templateKey,
            TemplateOutputBucket: outputAsset.s3BucketName
        }
    });
    customResource.node.addDependency(templateWriterPolicy);
    return {
        s3Bucket: outputAsset.bucket,
        s3Key: customResource.getAttString('TemplateOutputKey'),
        customResource
    };
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGVtcGxhdGUtd3JpdGVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsidGVtcGxhdGUtd3JpdGVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQTs7Ozs7Ozs7Ozs7R0FXRzs7QUE2RUgsZ0ZBNkRDO0FBdklELDJDQUEyQztBQUMzQyxpREFBaUQ7QUFFakQsNkNBQWtEO0FBQ2xELDZEQUFrRDtBQUNsRCw2QkFBNkI7QUFDN0IsbUVBQXdEO0FBQ3hELHlEQUFxRTtBQUNyRSxtQ0FBdUU7QUFHdkUsMkRBQTJEO0FBK0QzRCxTQUFnQixrQ0FBa0MsQ0FDaEQsS0FBZ0IsRUFDaEIsRUFBVSxFQUNWLEtBQTBCO0lBRzFCLE1BQU0sV0FBVyxHQUFHLElBQUkscUJBQUssQ0FBQyxLQUFLLEVBQUUsR0FBRyxFQUFFLGFBQWEsRUFBRTtRQUN2RCxJQUFJLEVBQUUsSUFBSSxDQUFDLElBQUksQ0FBQyxTQUFTLEVBQUUsYUFBYSxDQUFDO0tBQzFDLENBQUMsQ0FBQztJQUVILE1BQU0sb0JBQW9CLEdBQUcsSUFBQSwwQkFBbUIsRUFBQyxLQUFLLEVBQUU7UUFDdEQsbUJBQW1CLEVBQUU7WUFDbkIsT0FBTyxFQUFFLFFBQVEsQ0FBQyxxQ0FBcUM7WUFDdkQsT0FBTyxFQUFFLGVBQWU7WUFDeEIsSUFBSSxFQUFFLE1BQU0sQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLEdBQUcsU0FBUyxrQ0FBa0MsQ0FBQztZQUMzRSxPQUFPLEVBQUUsS0FBSyxDQUFDLE9BQU87WUFDdEIsVUFBVSxFQUFFLEtBQUssQ0FBQyxVQUFVO1NBQzdCO0tBQ0YsQ0FBQyxDQUFDO0lBRUgsTUFBTSxvQkFBb0IsR0FBRyxJQUFJLEdBQUcsQ0FBQyxNQUFNLENBQUMsS0FBSyxFQUFFLEdBQUcsRUFBRSxzQkFBc0IsRUFBRTtRQUM5RSxVQUFVLEVBQUU7WUFDVixJQUFJLEdBQUcsQ0FBQyxlQUFlLENBQUM7Z0JBQ3RCLE9BQU8sRUFBRSxDQUFFLGNBQWMsQ0FBRTtnQkFDM0IsTUFBTSxFQUFFLEdBQUcsQ0FBQyxNQUFNLENBQUMsS0FBSztnQkFDeEIsU0FBUyxFQUFFLENBQUUsT0FBTyxpQkFBRyxDQUFDLFNBQVMsU0FBUyxLQUFLLENBQUMsY0FBYyxDQUFDLFVBQVUsSUFBSSxLQUFLLENBQUMsV0FBVyxFQUFFLENBQUM7YUFDbEcsQ0FBQztZQUNGLElBQUksR0FBRyxDQUFDLGVBQWUsQ0FBQztnQkFDdEIsT0FBTyxFQUFFLENBQUUsY0FBYyxDQUFFO2dCQUMzQixNQUFNLEVBQUUsR0FBRyxDQUFDLE1BQU0sQ0FBQyxLQUFLO2dCQUN4QixTQUFTLEVBQUUsQ0FBRSxPQUFPLGlCQUFHLENBQUMsU0FBUyxTQUFTLFdBQVcsQ0FBQyxZQUFZLElBQUksQ0FBQzthQUN4RSxDQUFDO1NBQ0g7S0FDRixDQUFDLENBQUM7SUFFSCxvQkFBb0IsQ0FBQyxJQUFJLEVBQUUsa0JBQWtCLENBQUMsb0JBQW9CLENBQUMsQ0FBQztJQUVwRSxNQUFNLHNCQUFzQixHQUFHLElBQUksMkJBQVEsQ0FBQyxLQUFLLEVBQUUsR0FBRyxFQUFFLHdCQUF3QixFQUFFO1FBQ2hGLGNBQWMsRUFBRSxvQkFBb0I7S0FDckMsQ0FBQyxDQUFDO0lBRUgsSUFBQSxvREFBNEMsRUFBQyxzQkFBc0IsQ0FBQyxDQUFDO0lBRXJFLE1BQU0sY0FBYyxHQUFHLElBQUksNEJBQWMsQ0FBQyxLQUFLLEVBQUUsR0FBRyxFQUFFLDhCQUE4QixFQUFFO1FBQ3BGLFlBQVksRUFBRSx3QkFBd0I7UUFDdEMsWUFBWSxFQUFFLHNCQUFzQixDQUFDLFlBQVk7UUFDakQsVUFBVSxFQUFFO1lBQ1YsY0FBYyxFQUFFLElBQUksQ0FBQyxTQUFTLENBQUMsRUFBRSxjQUFjLEVBQUUsS0FBSyxDQUFDLGNBQWMsRUFBRSxDQUFDO1lBQ3hFLG1CQUFtQixFQUFFLEtBQUssQ0FBQyxjQUFjLENBQUMsVUFBVTtZQUNwRCxnQkFBZ0IsRUFBRSxLQUFLLENBQUMsV0FBVztZQUNuQyxvQkFBb0IsRUFBRSxXQUFXLENBQUMsWUFBWTtTQUMvQztLQUNGLENBQUMsQ0FBQztJQUVILGNBQWMsQ0FBQyxJQUFJLENBQUMsYUFBYSxDQUFDLG9CQUFvQixDQUFDLENBQUM7SUFFeEQsT0FBTztRQUNMLFFBQVEsRUFBRSxXQUFXLENBQUMsTUFBTTtRQUM1QixLQUFLLEVBQUUsY0FBYyxDQUFDLFlBQVksQ0FBQyxtQkFBbUIsQ0FBQztRQUN2RCxjQUFjO0tBQ2YsQ0FBQztBQUNKLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqICBDb3B5cmlnaHQgQW1hem9uLmNvbSwgSW5jLiBvciBpdHMgYWZmaWxpYXRlcy4gQWxsIFJpZ2h0cyBSZXNlcnZlZC5cbiAqXG4gKiAgTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKS4gWW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZVxuICogIHdpdGggdGhlIExpY2Vuc2UuIEEgY29weSBvZiB0aGUgTGljZW5zZSBpcyBsb2NhdGVkIGF0XG4gKlxuICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiAgb3IgaW4gdGhlICdsaWNlbnNlJyBmaWxlIGFjY29tcGFueWluZyB0aGlzIGZpbGUuIFRoaXMgZmlsZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAnQVMgSVMnIEJBU0lTLCBXSVRIT1VUIFdBUlJBTlRJRVNcbiAqICBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBleHByZXNzIG9yIGltcGxpZWQuIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9uc1xuICogIGFuZCBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuXG5pbXBvcnQgKiBhcyBjZGsgZnJvbSBcImF3cy1jZGstbGliXCI7XG5pbXBvcnQgKiBhcyBpYW0gZnJvbSAnYXdzLWNkay1saWIvYXdzLWlhbSc7XG5pbXBvcnQgKiBhcyBsYW1iZGEgZnJvbSAnYXdzLWNkay1saWIvYXdzLWxhbWJkYSc7XG5pbXBvcnQgKiBhcyBzMyBmcm9tICdhd3MtY2RrLWxpYi9hd3MtczMnO1xuaW1wb3J0IHsgQXdzLCBDdXN0b21SZXNvdXJjZSB9IGZyb20gJ2F3cy1jZGstbGliJztcbmltcG9ydCB7IEFzc2V0IH0gZnJvbSBcImF3cy1jZGstbGliL2F3cy1zMy1hc3NldHNcIjtcbmltcG9ydCAqIGFzIHBhdGggZnJvbSAncGF0aCc7XG5pbXBvcnQgeyBQcm92aWRlciB9IGZyb20gXCJhd3MtY2RrLWxpYi9jdXN0b20tcmVzb3VyY2VzXCI7XG5pbXBvcnQgeyBidWlsZExhbWJkYUZ1bmN0aW9uIH0gZnJvbSBcIkBhd3Mtc29sdXRpb25zLWNvbnN0cnVjdHMvY29yZVwiO1xuaW1wb3J0IHsgYWRkQ2ZuU3VwcHJlc3NSdWxlc0ZvckN1c3RvbVJlc291cmNlUHJvdmlkZXIgfSBmcm9tIFwiLi91dGlsc1wiO1xuLy8gTm90ZTogVG8gZW5zdXJlIENES3YyIGNvbXBhdGliaWxpdHksIGtlZXAgdGhlIGltcG9ydCBzdGF0ZW1lbnQgZm9yIENvbnN0cnVjdCBzZXBhcmF0ZVxuaW1wb3J0IHsgQ29uc3RydWN0IH0gZnJvbSAnY29uc3RydWN0cyc7XG5pbXBvcnQgKiBhcyBkZWZhdWx0cyBmcm9tICdAYXdzLXNvbHV0aW9ucy1jb25zdHJ1Y3RzL2NvcmUnO1xuXG4vKipcbiAqIFRoZSBUZW1wbGF0ZVZhbHVlIGludGVyZmFjZSBkZWZpbmVzIHRoZSBpZC12YWx1ZSBwYWlyIHRoYXQgd2lsbFxuICogYmUgc3Vic3RpdHV0ZWQgaW4gdGhlIHRlbXBsYXRlLlxuICpcbiAqIEZvciBleGFtcGxlLCBnaXZlbiB0aGUgdGVtcGxhdGU6XG4gKiB0ZW1wbGF0ZTpcbiAqICAgaGVsbG8gbmFtZV9wbGFjZWhvbGRlciwgbmljZSB0byBtZWV0IHlvdVxuICpcbiAqIGFuZCBhbiBpbnN0YW50aWF0aW9uIG9mIFRlbXBsYXRlVmFsdWUgeyBpZDogJ25hbWVfcGxhY2Vob2xkZXInLCB2YWx1ZTogJ2plZmYnIH1cbiAqXG4gKiB0aGUgdGVtcGxhdGUgd2lsbCBiZSB0cmFuc2Zvcm1lZCB0bzpcbiAqIHRlbXBsYXRlOlxuICogICBoZWxsbyBqZWZmLCBuaWNlIHRvIG1lZXQgeW91XG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgVGVtcGxhdGVWYWx1ZSB7XG4gIC8qKlxuICAgKiBUaGUgcGxhY2Vob2xkZXIgc3RyaW5nIHRvIGJlIHJlcGxhY2VkIGluIHRoZSB0ZW1wbGF0ZS5cbiAgICovXG4gIHJlYWRvbmx5IGlkOiBzdHJpbmc7XG4gIC8qKlxuICAgKiBUaGUgdmFsdWUgdG8gcmVwbGFjZSB0aGUgcGxhY2Vob2xkZXIgaW4gdGhlIHRlbXBsYXRlIHdpdGguXG4gICAqL1xuICByZWFkb25seSB2YWx1ZTogc3RyaW5nO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFRlbXBsYXRlV3JpdGVyUHJvcHMge1xuICAvKipcbiAgICogVGhlIFMzIGJ1Y2tldCB0aGF0IGhvbGRzIHRoZSB0ZW1wbGF0ZSB0byB0cmFuc2Zvcm0uXG4gICAqIFVwc3RyZWFtIHRoaXMgY2FuIGNvbWUgZWl0aGVyIGZyb20gYW4gQXNzZXQgb3IgUzMgYnVja2V0IGRpcmVjdGx5LlxuICAgKiBJbnRlcm5hbGx5IGl0IHdpbGwgYWx3YXlzIHJlc29sdmUgdG8gUzMgYnVja2V0IGluIGVpdGhlciBjYXNlICh0aGUgY2RrIGFzc2V0IGJ1Y2tldCBvciB0aGUgY3VzdG9tZXItZGVmaW5lZCBidWNrZXQpLlxuICAgKi9cbiAgcmVhZG9ubHkgdGVtcGxhdGVCdWNrZXQ6IHMzLklCdWNrZXQ7XG4gIC8qKlxuICAgKiBUaGUgUzMgb2JqZWN0IGtleSBvZiB0aGUgdGVtcGxhdGUgdG8gdHJhbnNmb3JtLlxuICAgKi9cbiAgcmVhZG9ubHkgdGVtcGxhdGVLZXk6IHN0cmluZztcbiAgLyoqXG4gICAqIEFuIGFycmF5IG9mIFRlbXBsYXRlVmFsdWUgb2JqZWN0cywgZWFjaCBkZWZpbmluZyBhIHBsYWNlaG9sZGVyIHN0cmluZyBpbiB0aGVcbiAgICogdGVtcGxhdGUgdGhhdCB3aWxsIGJlIHJlcGxhY2VkIHdpdGggaXRzIGNvcnJlc3BvbmRpbmcgdmFsdWUuXG4gICAqL1xuICByZWFkb25seSB0ZW1wbGF0ZVZhbHVlczogVGVtcGxhdGVWYWx1ZVtdXG4gIC8qKlxuICAgKiBPcHRpb25hbCBjb25maWd1cmF0aW9uIGZvciB1c2VyLWRlZmluZWQgZHVyYXRpb24gb2YgdGhlIGJhY2tpbmcgTGFtYmRhIGZ1bmN0aW9uLCB3aGljaCBtYXkgYmUgbmVjZXNzYXJ5IHdoZW4gdHJhbnNmb3JtaW5nIHZlcnkgbGFyZ2Ugb2JqZWN0cy5cbiAgICpcbiAgICogQGRlZmF1bHQgRHVyYXRpb24uc2Vjb25kcygzKVxuICAgKi9cbiAgcmVhZG9ubHkgdGltZW91dD86IGNkay5EdXJhdGlvbjtcbiAgLyoqXG4gICAqIE9wdGlvbmFsIGNvbmZpZ3VyYXRpb24gZm9yIHVzZXItZGVmaW5lZCBtZW1vcnlTaXplIG9mIHRoZSBiYWNraW5nIExhbWJkYSBmdW5jdGlvbiwgd2hpY2ggbWF5IGJlIG5lY2Vzc2FyeSB3aGVuIHRyYW5zZm9ybWluZyB2ZXJ5IGxhcmdlIG9iamVjdHMuXG4gICAqXG4gICAqIEBkZWZhdWx0IDEyOFxuICAgKi9cbiAgcmVhZG9ubHkgbWVtb3J5U2l6ZT86IG51bWJlcjtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBDcmVhdGVUZW1wbGF0ZVdyaXRlclJlc3BvbnNlIHtcbiAgcmVhZG9ubHkgczNCdWNrZXQ6IHMzLklCdWNrZXQ7XG4gIHJlYWRvbmx5IHMzS2V5OiBzdHJpbmc7XG4gIHJlYWRvbmx5IGN1c3RvbVJlc291cmNlOiBDdXN0b21SZXNvdXJjZTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZVRlbXBsYXRlV3JpdGVyQ3VzdG9tUmVzb3VyY2UoXG4gIHNjb3BlOiBDb25zdHJ1Y3QsXG4gIGlkOiBzdHJpbmcsXG4gIHByb3BzOiBUZW1wbGF0ZVdyaXRlclByb3BzXG4pOiBDcmVhdGVUZW1wbGF0ZVdyaXRlclJlc3BvbnNlIHtcblxuICBjb25zdCBvdXRwdXRBc3NldCA9IG5ldyBBc3NldChzY29wZSwgYCR7aWR9T3V0cHV0QXNzZXRgLCB7XG4gICAgcGF0aDogcGF0aC5qb2luKF9fZGlybmFtZSwgJ3BsYWNlaG9sZGVyJylcbiAgfSk7XG5cbiAgY29uc3QgdGVtcGxhdGVXcml0ZXJMYW1iZGEgPSBidWlsZExhbWJkYUZ1bmN0aW9uKHNjb3BlLCB7XG4gICAgbGFtYmRhRnVuY3Rpb25Qcm9wczoge1xuICAgICAgcnVudGltZTogZGVmYXVsdHMuQ09NTUVSQ0lBTF9SRUdJT05fTEFNQkRBX05PREVfUlVOVElNRSxcbiAgICAgIGhhbmRsZXI6ICdpbmRleC5oYW5kbGVyJyxcbiAgICAgIGNvZGU6IGxhbWJkYS5Db2RlLmZyb21Bc3NldChgJHtfX2Rpcm5hbWV9L3RlbXBsYXRlLXdyaXRlci1jdXN0b20tcmVzb3VyY2VgKSxcbiAgICAgIHRpbWVvdXQ6IHByb3BzLnRpbWVvdXQsXG4gICAgICBtZW1vcnlTaXplOiBwcm9wcy5tZW1vcnlTaXplLFxuICAgIH1cbiAgfSk7XG5cbiAgY29uc3QgdGVtcGxhdGVXcml0ZXJQb2xpY3kgPSBuZXcgaWFtLlBvbGljeShzY29wZSwgYCR7aWR9VGVtcGxhdGVXcml0ZXJQb2xpY3lgLCB7XG4gICAgc3RhdGVtZW50czogW1xuICAgICAgbmV3IGlhbS5Qb2xpY3lTdGF0ZW1lbnQoe1xuICAgICAgICBhY3Rpb25zOiBbICdzMzpHZXRPYmplY3QnIF0sXG4gICAgICAgIGVmZmVjdDogaWFtLkVmZmVjdC5BTExPVyxcbiAgICAgICAgcmVzb3VyY2VzOiBbIGBhcm46JHtBd3MuUEFSVElUSU9OfTpzMzo6OiR7cHJvcHMudGVtcGxhdGVCdWNrZXQuYnVja2V0TmFtZX0vJHtwcm9wcy50ZW1wbGF0ZUtleX1gXVxuICAgICAgfSksXG4gICAgICBuZXcgaWFtLlBvbGljeVN0YXRlbWVudCh7XG4gICAgICAgIGFjdGlvbnM6IFsgJ3MzOlB1dE9iamVjdCcgXSxcbiAgICAgICAgZWZmZWN0OiBpYW0uRWZmZWN0LkFMTE9XLFxuICAgICAgICByZXNvdXJjZXM6IFsgYGFybjoke0F3cy5QQVJUSVRJT059OnMzOjo6JHtvdXRwdXRBc3NldC5zM0J1Y2tldE5hbWV9LypgXVxuICAgICAgfSlcbiAgICBdXG4gIH0pO1xuXG4gIHRlbXBsYXRlV3JpdGVyTGFtYmRhLnJvbGU/LmF0dGFjaElubGluZVBvbGljeSh0ZW1wbGF0ZVdyaXRlclBvbGljeSk7XG5cbiAgY29uc3QgdGVtcGxhdGVXcml0ZXJQcm92aWRlciA9IG5ldyBQcm92aWRlcihzY29wZSwgYCR7aWR9VGVtcGxhdGVXcml0ZXJQcm92aWRlcmAsIHtcbiAgICBvbkV2ZW50SGFuZGxlcjogdGVtcGxhdGVXcml0ZXJMYW1iZGFcbiAgfSk7XG5cbiAgYWRkQ2ZuU3VwcHJlc3NSdWxlc0ZvckN1c3RvbVJlc291cmNlUHJvdmlkZXIodGVtcGxhdGVXcml0ZXJQcm92aWRlcik7XG5cbiAgY29uc3QgY3VzdG9tUmVzb3VyY2UgPSBuZXcgQ3VzdG9tUmVzb3VyY2Uoc2NvcGUsIGAke2lkfVRlbXBsYXRlV3JpdGVyQ3VzdG9tUmVzb3VyY2VgLCB7XG4gICAgcmVzb3VyY2VUeXBlOiAnQ3VzdG9tOjpUZW1wbGF0ZVdyaXRlcicsXG4gICAgc2VydmljZVRva2VuOiB0ZW1wbGF0ZVdyaXRlclByb3ZpZGVyLnNlcnZpY2VUb2tlbixcbiAgICBwcm9wZXJ0aWVzOiB7XG4gICAgICBUZW1wbGF0ZVZhbHVlczogSlNPTi5zdHJpbmdpZnkoeyB0ZW1wbGF0ZVZhbHVlczogcHJvcHMudGVtcGxhdGVWYWx1ZXMgfSksXG4gICAgICBUZW1wbGF0ZUlucHV0QnVja2V0OiBwcm9wcy50ZW1wbGF0ZUJ1Y2tldC5idWNrZXROYW1lLFxuICAgICAgVGVtcGxhdGVJbnB1dEtleTogcHJvcHMudGVtcGxhdGVLZXksXG4gICAgICBUZW1wbGF0ZU91dHB1dEJ1Y2tldDogb3V0cHV0QXNzZXQuczNCdWNrZXROYW1lXG4gICAgfVxuICB9KTtcblxuICBjdXN0b21SZXNvdXJjZS5ub2RlLmFkZERlcGVuZGVuY3kodGVtcGxhdGVXcml0ZXJQb2xpY3kpO1xuXG4gIHJldHVybiB7XG4gICAgczNCdWNrZXQ6IG91dHB1dEFzc2V0LmJ1Y2tldCxcbiAgICBzM0tleTogY3VzdG9tUmVzb3VyY2UuZ2V0QXR0U3RyaW5nKCdUZW1wbGF0ZU91dHB1dEtleScpLFxuICAgIGN1c3RvbVJlc291cmNlXG4gIH07XG59Il19